<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>채권관리 평가</title>
<style>
  body { font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; }
  .hidden { display: none !important; }
  button {
    padding: 10px 15px;
    margin: 5px 0;
    font-size: 16px;
    border-radius: 5px;
    -webkit-tap-highlight-color: transparent;
  }
  .choice {
    display: block;
    padding: 12px;
    margin: 5px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
  }
  .choice.correct { background: #c8f7c5; }
  .choice.wrong { background: #f7c5c5; }
  #progress { margin-top: 20px; font-weight: bold; }
</style>
</head>
<body>

<div id="subjectSelection">
  <h2>과목 선택</h2>
  <button onclick="startQuiz('1과목')" ontouchstart="startQuiz('1과목')">1과목</button>
  <button onclick="startQuiz('2과목')" ontouchstart="startQuiz('2과목')">2과목</button>
  <button onclick="startQuiz('3과목')" ontouchstart="startQuiz('3과목')">3과목</button>
</div>

<div id="quiz" class="hidden">
  <div id="question"></div>
  <div id="choices"></div>
  <button id="checkBtn">확인</button>
  <button id="nextBtn">다음</button>
  <button id="goBackBtn" onclick="goBackToSubjects()" ontouchstart="goBackToSubjects()">과목 선택으로</button>
  <div id="progress"></div>
</div>

<script>
// -------------------- 문제 데이터 (샘플) --------------------
const allQuestions = {
  "1과목": [
    {question:"A은 무엇인가?", options:["A","B","C","D"], answer:1},
    {question:"C은 무엇인가?", options:["A","B","C","D"], answer:3}
   ],
  "2과목": [
    {question:"B은 무엇인가?", options:["A","B","C","D"], answer:2},
    {question:"A은 무엇인가?", options:["A","B","C","D"], answer:1}
  ],
  "3과목": [
    {question:"D은 무엇인가?", options:["A","B","C","D"], answer:4},
    {question:"A은 무엇인가?", options:["A","B","C","D"], answer:1}
  ]
};

// -------------------- 앱 로직 --------------------
let currentSubject = "";
let questions = [];
let currentIndex = 0;
let selectedIndex = -1;
let answered = false;
let correctCount = 0;

function startQuiz(subject) {
  currentSubject = subject;
  questions = [...allQuestions[subject]];
  shuffleArray(questions);
  currentIndex = 0; selectedIndex=-1; answered=false; correctCount=0;

  const subjDiv = document.getElementById("subjectSelection");
  const quizDiv = document.getElementById("quiz");

  // 화면 전환
  subjDiv.classList.add("hidden");
  quizDiv.classList.remove("hidden");

  // iOS 강제 리렌더
  quizDiv.offsetHeight;

  showQuestion();
}

function showQuestion() {
  answered = false;
  selectedIndex = -1;
  const q = questions[currentIndex];
  const questionDiv = document.getElementById("question");
  const choicesDiv = document.getElementById("choices");
  questionDiv.innerHTML = `<b>[${currentSubject}]</b> ${q.question}`;
  choicesDiv.innerHTML = "";
  q.options.forEach((opt, idx)=>{
    const btn = document.createElement("div");
    btn.className = "choice";
    btn.innerText = `${idx+1}. ${opt}`;
    btn.dataset.index = idx;
    btn.onclick = btn.ontouchstart = () => selectAnswer(idx, btn);
    choicesDiv.appendChild(btn);
  });
  document.getElementById("progress").innerText = `${currentIndex+1} / ${questions.length}`;
  document.getElementById("checkBtn").classList.remove("hidden");
  document.getElementById("nextBtn").classList.add("hidden");
}

function selectAnswer(idx, btn){
  selectedIndex = parseInt(idx);
  Array.from(document.getElementsByClassName("choice")).forEach(c => c.style.borderColor="#ccc");
  btn.style.borderColor="#000";
}

document.getElementById("checkBtn").onclick = document.getElementById("checkBtn").ontouchstart = () => {
  if(selectedIndex === -1) return alert("보기 선택 후 확인하세요!");
  const q = questions[currentIndex];
  const choices = document.getElementsByClassName("choice");
  const answerIdx = parseInt(q.answer) - 1;
  for(let i=0;i<choices.length;i++){
    if(i === answerIdx) choices[i].classList.add("correct");
    if(i === selectedIndex && i !== answerIdx) choices[i].classList.add("wrong");
    choices[i].style.pointerEvents = "none";
  }
  if(selectedIndex === answerIdx) correctCount++;
  answered = true;
  document.getElementById("checkBtn").classList.add("hidden");
  document.getElementById("nextBtn").classList.remove("hidden");
};

document.getElementById("nextBtn").onclick = document.getElementById("nextBtn").ontouchstart = () => {
  if(!answered) return;
  currentIndex++;
  if(currentIndex >= questions.length){
    alert(`모든 문제를 완료했습니다!\n정답: ${correctCount} / ${questions.length}`);
    document.getElementById("quiz").classList.add("hidden");
    document.getElementById("subjectSelection").classList.remove("hidden");
  } else {
    showQuestion();
  }
};

function goBackToSubjects() {
  if(confirm("과목 선택 화면으로 돌아가면 현재 진행중인 문제는 초기화됩니다. 이동하시겠습니까?")){
    document.getElementById("quiz").classList.add("hidden");
    document.getElementById("subjectSelection").classList.remove("hidden");
  }
}

// -------------------- 유틸 --------------------
function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}
</script>

</body>
</html>
